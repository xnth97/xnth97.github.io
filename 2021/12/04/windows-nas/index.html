<!doctype html>
<html lang="zh-Hans" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">P340 工作站搭建家庭服务器 | NOWHERE</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://xnth97.github.io/2021/12/04/windows-nas"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="P340 工作站搭建家庭服务器 | NOWHERE"><meta data-rh="true" name="description" content="最近打算购入 NAS，比较来比较去群晖和 QNAP，突然被同事安利巨硬员工可以打骨折购买 ThinkStation，于是用接近一台 DS920+ 的价格购入了最低配 ThinkStation P340 工作站。基于这台机器，这两天逐渐搭建起了我的家庭服务器。"><meta data-rh="true" property="og:description" content="最近打算购入 NAS，比较来比较去群晖和 QNAP，突然被同事安利巨硬员工可以打骨折购买 ThinkStation，于是用接近一台 DS920+ 的价格购入了最低配 ThinkStation P340 工作站。基于这台机器，这两天逐渐搭建起了我的家庭服务器。"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2021-12-04T13:18:33.000Z"><meta data-rh="true" property="article:tag" content="daily,gears"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://xnth97.github.io/2021/12/04/windows-nas"><link data-rh="true" rel="alternate" href="https://xnth97.github.io/2021/12/04/windows-nas" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://xnth97.github.io/2021/12/04/windows-nas" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="NOWHERE RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="NOWHERE Atom Feed"><link rel="stylesheet" href="/assets/css/styles.cf5f2552.css">
<link rel="preload" href="/assets/js/runtime~main.c050e843.js" as="script">
<link rel="preload" href="/assets/js/main.eb9a556c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/avatar.png" alt="Blog avatar" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/avatar.png" alt="Blog avatar" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">NOWHERE</b></a><a class="navbar__item navbar__link" href="/tags/daily">日常</a><a class="navbar__item navbar__link" href="/tags/gears">剁手</a><a class="navbar__item navbar__link" href="/tags/note">笔记</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/link">友链</a><a class="navbar__item navbar__link" href="/about">关于我</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><main class="col col--9 col--offset-1" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">P340 工作站搭建家庭服务器</h1><div class="container_mt6G margin-vert--md"><time datetime="2021-12-04T13:18:33.000Z" itemprop="datePublished">2021年12月4日</time> · <!-- -->阅读需 11 分钟</div></header><div id="post-content" class="markdown" itemprop="articleBody"><p>最近打算购入 NAS，比较来比较去群晖和 QNAP，突然被同事安利巨硬员工可以打骨折购买 ThinkStation，于是用接近一台 DS920+ 的价格购入了最低配 ThinkStation P340 工作站。基于这台机器，这两天逐渐搭建起了我的家庭服务器。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="硬件">硬件<a href="#硬件" class="hash-link" aria-label="硬件的直接链接" title="硬件的直接链接">​</a></h2><p><img loading="lazy" src="/assets/images/thinkstation-af7e1af58740eb6c6b46b5a3123d6cc9.jpg" width="1200" height="1763" class="img_ev3q"></p><p>外观是 ThinkStation 一如既往的低调，体积也没有很大。最低配 P340 带有 10 代 i3 处理器，四核八线程对家庭服务器绰绰有余。内存自带不够看的 4GB，购入两根海盗船组成 20GB 内存。比较良心的是自带 256GB M2 SSD 用来装系统，又购买了两块 WD NAS 红盘作为存储。许多年没碰过正经的塔式计算机了，目测 ThinkStation 用料还是相对丐的（但是绝对足够用）。令我比较印象深刻的是 ThinkStation 的盘位托架非常优雅，不需要螺丝固定，仅需要抽拉和推动拉手来依靠机械结构固定，看来设计时充分考虑到了扩展性。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="os">OS<a href="#os" class="hash-link" aria-label="OS的直接链接" title="OS的直接链接">​</a></h2><p>物理机操作系统选用 Windows Server 2022。倒不是不熟悉 Linux，主要是<del>为了巨硬员工的尊严</del>。正经的理由是：我需要物理机操作系统只负责底层的存储和虚拟化，其它所有服务均通过部署其上的虚拟机提供，这样不会担心乱搞把全家的服务都搞挂了。Windows Server 的优势在于开箱即用地提供了极为稳定的基础功能：</p><ul><li>存储池用来管理磁盘 raid</li><li>基于网络的文件共享（SMB 与 NFS）</li><li>Hyper-V 虚拟机</li><li>完善的远程管理（Windows Admin Center，远程桌面）</li></ul><p><img loading="lazy" src="/assets/images/server-dd25b6ce5463076f5ab99212c773ed92.png" width="1400" height="1038" class="img_ev3q"></p><p>通过服务器管理器，所有基础搭建都可以轻松地通过 GUI 设置完成，不需要像 Linux 一样安装额外软件包或者修改 <code>/etc/fstab</code> 之类，个人感觉非常适合家用服务器的部署。存储池、文件共享和 Hyper-V 大家都比较熟悉了，这里多说一下宝藏 <a href="https://www.microsoft.com/en-us/evalcenter/evaluate-windows-admin-center" target="_blank" rel="noopener noreferrer">Windows Admin Center</a>，这个免费的软件实在是太香了。它也是开箱即用地提供了一个完善的 web 管理页面，不仅能够实时查看服务器状态，更能直接管理防火墙、服务、虚拟机、文件甚至注册表项等。</p><p><img loading="lazy" src="/assets/images/wac-b0ddf6f21792d0504f9fcc0955fbd052.png" width="1400" height="979" class="img_ev3q"></p><p>我对 NAS 的使用需求很简单，主要就是提供一个网络驱动器存放文件以及通过 Lightroom 库管理照片，因此 Windows Server 自带的文件共享绰绰有余。其他设备直接挂载来访问，读写速度大概在 90 - 95 MB/s 上下，对于机械盘也勉强可用了。</p><p><img loading="lazy" src="/assets/images/speedtest-d97f3e80e64d2ecd6f9ad5c490922e4c.png" width="1024" height="1056" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="虚拟机">虚拟机<a href="#虚拟机" class="hash-link" aria-label="虚拟机的直接链接" title="虚拟机的直接链接">​</a></h2><p>其它所有的家庭服务，我通过 Hyper-V 上的三个虚拟机部署和管理。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="家庭核心服务">家庭核心服务<a href="#家庭核心服务" class="hash-link" aria-label="家庭核心服务的直接链接" title="家庭核心服务的直接链接">​</a></h3><p>之前介绍过我家有些服务跑在一台树莓派上，然而对于性能敏感的任务还是很捉急（比如 <code>ffmpeg</code> 解码 Ring 摄像头视频流传输到 HomeKit）。这次我开了一台 Ubuntu Server 2 CPU + 2GB RAM 的虚拟机来接手原来树莓派上智能家居相关服务，主要有负责桥接家里 IoT 设备的 <a href="https://homebridge.io" target="_blank" rel="noopener noreferrer">homebridge</a>，将 Chromecast 转为 AirPlay 的 <a href="https://github.com/philippe44/AirConnect/tree/master/aircast" target="_blank" rel="noopener noreferrer">aircast</a>，和下载文件的 <code>aria2</code> 以及 <a href="https://github.com/ziahamza/webui-aria2" target="_blank" rel="noopener noreferrer">webui-aria2</a> 作为 UI 管理后台。这些服务全部通过 <code>pm2</code> 来进行管理，在遇到问题时可以自动重启。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="adguard-home">AdGuard Home<a href="#adguard-home" class="hash-link" aria-label="AdGuard Home的直接链接" title="AdGuard Home的直接链接">​</a></h4><p><a href="https://adguard.com/zh_cn/adguard-home/overview.html" target="_blank" rel="noopener noreferrer">AdGuard Home</a> 是一款开源 DNS 服务器，主要用来拦截广告和跟踪。在服务器上直接使用 snap 安装：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo snap install adguard-home</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后打开服务器的 3000 端口地址去进行初始化，一般在这一步会有 53 端口被占用的问题。首先停用 <code>systemd-resolved</code> 服务：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl stop systemd-resolved</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后编辑 <code>/etc/systemd/resolved.conf</code>，添加 <code>DNS</code>、<code>FallbackDNS</code> 并修改 <code>DNSStubListener=no</code>，最后更新 <code>resolv.conf</code>：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo ln -sf /run/systemd/resolve/resolv.conf /etc/resolv.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="/assets/images/adguard-fa95339eb522cc96f443b4fee5b1e88a.png" width="1440" height="970" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="挂载">挂载<a href="#挂载" class="hash-link" aria-label="挂载的直接链接" title="挂载的直接链接">​</a></h4><p>在 Windows Server 上，我创建了一个新的文件共享服务用来共享 <code>Downloads</code> 文件夹。在 Ubuntu Server 上，首先安装 <code>cifs-utils</code>，创建 <code>/mnt/downloads</code> 作为挂载点，创建一个 credentials 存放用户名密码：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">username=USERNAME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">password=PASSWORD</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>修改 <code>/etc/fstab</code> 加上:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//SERVER_IP/Downloads /mnt/downloads cifs credentials=/path/to/credentials,uid=1000,gid=1000,iocharset=utf8,rw,file_mode=0777,dir_mode=0777,sec=ntlmv2 0 0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后运行 <code>sudo mount -a</code> 挂载，Ubuntu 即可以读写网络驱动器里的文件了。需要注意的是，此处 <code>USERNAME</code> 的用户必须在 Windows Server 里也设置好对应的读写权限，否则容易出现 <code>permission denied</code> 错误。</p><p>对于这些智能家居相关的核心服务，我的想法是将它们物理隔离在一台虚拟机上，创建好检查点，这样一般不需要去动它们，万一因为更新之类的原因搞挂了也可以迅速恢复，避免对家庭使用造成影响。至于其它玩耍的服务可以开新的虚拟机去尽情折腾。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2022-年更新替换-ubuntu-为-windows-server-core">2022 年更新：替换 Ubuntu 为 Windows Server Core<a href="#2022-年更新替换-ubuntu-为-windows-server-core" class="hash-link" aria-label="2022 年更新：替换 Ubuntu 为 Windows Server Core的直接链接" title="2022 年更新：替换 Ubuntu 为 Windows Server Core的直接链接">​</a></h4><p>运行家庭服务的 Ubuntu Server 更新 Jellyfish 后莫名其妙搞丢了我好多配置文件，而且基本每天一小崩两天一大崩，于是一怒之下更换为 Windows Server Core。用了几个月下来真是一个坚如磐石，虽然有几点不太满意的：</p><ul><li>缺乏包管理，<code>winget</code> 目前在 Server SKU 上用不了</li><li>Windows 服务还是比 systemctl 要复杂些，甚至还是第三方 app <a href="https://nssm.cc" target="_blank" rel="noopener noreferrer">nssm</a> 更为好用；即使这样还会带来复杂的权限问题</li><li>没有真正的 CLI 模式，占用较多内存（不过对于家用这也是优势）</li></ul><p>对于家用来说，大量 Linux 下的繁复操作（如挂载）在 Windows Server 里都具有内建的稳定对应功能实现，甚至由于 Server SKU + Hyper-V 还会有更高的性能表现。而且借助安装 <a href="https://docs.microsoft.com/en-us/windows-server/get-started/server-core-app-compatibility-feature-on-demand" target="_blank" rel="noopener noreferrer">FOD</a> 可以让 Windows Server 获得更多方便而基础的 GUI 管理工具，如 <code>explorer</code>、<code>taskmgr</code> 等。由于 Server Core 在 CLI 外表下其实具备完整 GUI（只是没有传统桌面 Shell），我们完全可以安装使用 Edge、VSCode 等更为复杂的应用来简化服务器部署与配置。</p><p><img loading="lazy" src="/assets/images/servercore-461c2f2378ad18132f4cc8836699f775.jpeg" width="970" height="800" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="乱七八糟服务">乱七八糟服务<a href="#乱七八糟服务" class="hash-link" aria-label="乱七八糟服务的直接链接" title="乱七八糟服务的直接链接">​</a></h3><p>由于服务器性能较为富裕，我又开了一台 Ubuntu Server 4 CPU + 8GB RAM 的虚拟机跑一些乱七八糟的服务。顺便安利一下 Hyper-V 的动态内存分配，可以允许虚拟机在指定的内存范围内动态变化，因此即使分配了 8GB RAM，在负荷低的情况下虚拟机也只会占用大约 1GB 左右 RAM，不会给宿主机造成太大压力。注意在 Hyper-V 上运行的 Linux，可以安装 azure 优化的内核获得更好的性能。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install linux-azure</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="/assets/images/hyperv-a3ee59aa14b980f3a0d15f719b1a3884.png" width="1600" height="989" class="img_ev3q"></p><p>在这台服务器上，我完全通过 Docker 部署了这些服务：</p><ul><li><a href="https://github.com/janeczku/calibre-web" target="_blank" rel="noopener noreferrer">calibre-web</a>：著名电子书管理软件的 web 前端，支持在线阅读。</li><li><a href="https://github.com/mattermost/focalboard" target="_blank" rel="noopener noreferrer">focalboard</a>：个人使用的 Jira，方便追踪一些个人小目标。</li><li><a href="https://github.com/cdr/code-server" target="_blank" rel="noopener noreferrer">code-server</a>：在线版的 VSCode，方便顺手直接改一些服务器上的代码/文件，比如上述所有服务的 <code>docker-compose.yml</code>。</li><li><a href="https://github.com/librespeed/speedtest" target="_blank" rel="noopener noreferrer">librespeed</a>：用来进行局域网测速。</li><li><a href="https://github.com/pawelmalak/flame" target="_blank" rel="noopener noreferrer">flame</a>：简易的 Dashboard，作为所有服务的统一入口。</li><li><a href="https://github.com/gogs/gogs" target="_blank" rel="noopener noreferrer">gogs</a>：自建轻量 git 服务器。</li><li><a href="https://github.com/kalcaddle/kodbox" target="_blank" rel="noopener noreferrer">kodbox</a>：可道云，基于 web 的文件管理。</li><li><a href="https://github.com/bpatrik/pigallery2" target="_blank" rel="noopener noreferrer">pigallery2</a>：基于 web 和文件夹的轻量化相册浏览。</li></ul><p><img loading="lazy" src="/assets/images/codeserver-85cf71ec3bda430db1be486677b51f0f.png" width="1400" height="1037" class="img_ev3q"></p><p><img loading="lazy" src="/assets/images/dashboard-853db493d2c0f2ac9bc6bed8ed08c622.png" width="1440" height="1020" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="桌面服务">桌面服务<a href="#桌面服务" class="hash-link" aria-label="桌面服务的直接链接" title="桌面服务的直接链接">​</a></h3><p>最后为了某些桌面应用场景（比如突然需要百度网盘这种流氓软件），我也分配了一台 2 CPU + 8GB RAM 的 Windows Server 服务器并开启了远程桌面。值得一提的是 Windows Server 具有<a href="https://docs.microsoft.com/zh-cn/windows-server/get-started/automatic-vm-activation" target="_blank" rel="noopener noreferrer">虚拟机自动激活</a>的特性，简单配置之后就可放心使用客户机。</p><p><img loading="lazy" src="/assets/images/rdp-4e6139b79776d52fa3dee9747098d00f.png" width="800" height="702" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="最后">最后<a href="#最后" class="hash-link" aria-label="最后的直接链接" title="最后的直接链接">​</a></h2><p>以上就是我的家庭服务器搭建。工作站硬件 + Windows Server，运行至今稳如老狗坚如磐石，总体来说还是满足了我家里的需求的。一些关于家用的想法：</p><ul><li>不甘于群晖又不放心完全自己搭建的话，成品工作站可能是个不错的折中。</li><li>家用服务器可以考虑 Windows Server，提供了很多开箱即用的稳定基础架构（市场部钱结一下谢谢）。</li><li>物理机尽可能稳定，保证服务简单。可以只提供 raid、虚拟化和文件共享。</li><li>虚拟机物理隔离服务，运用容器等方式保证易于部署和进程自守护。</li></ul></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/daily">daily</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/gears">gears</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="博文分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/2022/01/24/annual"><div class="pagination-nav__sublabel">较新一篇</div><div class="pagination-nav__label">红花郎杯 2021 年度我最喜爱颁奖</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/2021/03/18/tesla-model-y"><div class="pagination-nav__sublabel">较旧一篇</div><div class="pagination-nav__label">我的电瓶车时尚时尚最时尚</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#硬件" class="table-of-contents__link toc-highlight">硬件</a></li><li><a href="#os" class="table-of-contents__link toc-highlight">OS</a></li><li><a href="#虚拟机" class="table-of-contents__link toc-highlight">虚拟机</a><ul><li><a href="#家庭核心服务" class="table-of-contents__link toc-highlight">家庭核心服务</a></li><li><a href="#乱七八糟服务" class="table-of-contents__link toc-highlight">乱七八糟服务</a></li><li><a href="#桌面服务" class="table-of-contents__link toc-highlight">桌面服务</a></li></ul></li><li><a href="#最后" class="table-of-contents__link toc-highlight">最后</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/link">友链</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 NOWHERE</div></div></div></footer></div>
<script src="/assets/js/runtime~main.c050e843.js"></script>
<script src="/assets/js/main.eb9a556c.js"></script>
</body>
</html>