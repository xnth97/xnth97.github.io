<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>Creating Cross Platform SwiftUI App | NOWHERE</title>
  <meta name="author" content="Yubo Qin" />
  <meta name="description" content="一些碎碎念" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/images/blog/favicon/apple-touch-icon-57x57.png" />
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/blog/favicon/apple-touch-icon-114x114.png" />
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/blog/favicon/apple-touch-icon-72x72.png" />
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/blog/favicon/apple-touch-icon-144x144.png" />
  <link rel="apple-touch-icon-precomposed" sizes="60x60" href="/images/blog/favicon/apple-touch-icon-60x60.png" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/images/blog/favicon/apple-touch-icon-120x120.png" />
  <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/images/blog/favicon/apple-touch-icon-76x76.png" />
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/images/blog/favicon/apple-touch-icon-152x152.png" />
  <link rel="icon" type="image/png" href="/images/blog/favicon/favicon-196x196.png" sizes="196x196" />
  <link rel="icon" type="image/png" href="/images/blog/favicon/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/png" href="/images/blog/favicon/favicon-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="/images/blog/favicon/favicon-16x16.png" sizes="16x16" />
  <link rel="icon" type="image/png" href="/images/blog/favicon/favicon-128.png" sizes="128x128" />

  <link rel="stylesheet" type="text/css" href="/css/screen.css" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@200;300;400;500;600;700;900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&display=swap" rel="stylesheet">

  <meta name="generator" content="NOWHERE">

  
  
  
</head>


<body class="post-template">

  <!-- Generated using IconMoon -->
<svg aria-hidden="true" style="position: absolute; width: 0; height: 0; overflow: hidden;" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <defs>
  <symbol id="icon-facebook2" viewBox="0 0 32 32">
  <path d="M29 0h-26c-1.65 0-3 1.35-3 3v26c0 1.65 1.35 3 3 3h13v-14h-4v-4h4v-2c0-3.306 2.694-6 6-6h4v4h-4c-1.1 0-2 0.9-2 2v2h6l-1 4h-5v14h9c1.65 0 3-1.35 3-3v-26c0-1.65-1.35-3-3-3z"></path>
  </symbol>
  <symbol id="icon-twitter" viewBox="0 0 32 32">
  <path d="M32 7.075c-1.175 0.525-2.444 0.875-3.769 1.031 1.356-0.813 2.394-2.1 2.887-3.631-1.269 0.75-2.675 1.3-4.169 1.594-1.2-1.275-2.906-2.069-4.794-2.069-3.625 0-6.563 2.938-6.563 6.563 0 0.512 0.056 1.012 0.169 1.494-5.456-0.275-10.294-2.888-13.531-6.862-0.563 0.969-0.887 2.1-0.887 3.3 0 2.275 1.156 4.287 2.919 5.463-1.075-0.031-2.087-0.331-2.975-0.819 0 0.025 0 0.056 0 0.081 0 3.181 2.263 5.838 5.269 6.437-0.55 0.15-1.131 0.231-1.731 0.231-0.425 0-0.831-0.044-1.237-0.119 0.838 2.606 3.263 4.506 6.131 4.563-2.25 1.762-5.075 2.813-8.156 2.813-0.531 0-1.050-0.031-1.569-0.094 2.913 1.869 6.362 2.95 10.069 2.95 12.075 0 18.681-10.006 18.681-18.681 0-0.287-0.006-0.569-0.019-0.85 1.281-0.919 2.394-2.075 3.275-3.394z"></path>
  </symbol>
  <symbol id="icon-sina-weibo" viewBox="0 0 32 32">
  <path d="M13.444 28.063c-5.3 0.525-9.875-1.875-10.219-5.35-0.344-3.481 3.675-6.719 8.969-7.244 5.3-0.525 9.875 1.875 10.213 5.35 0.35 3.481-3.669 6.725-8.963 7.244zM24.038 16.519c-0.45-0.137-0.762-0.225-0.525-0.819 0.512-1.287 0.563-2.394 0.006-3.188-1.038-1.481-3.881-1.406-7.137-0.037 0 0-1.025 0.444-0.762-0.363 0.5-1.613 0.425-2.956-0.356-3.738-1.769-1.769-6.469 0.069-10.5 4.1-3.013 3.006-4.763 6.213-4.763 8.981 0 5.288 6.787 8.506 13.425 8.506 8.7 0 14.494-5.056 14.494-9.069 0-2.431-2.044-3.806-3.881-4.375z"></path>
  <path d="M29.819 6.831c-2.1-2.331-5.2-3.219-8.063-2.612v0c-0.663 0.144-1.081 0.794-0.938 1.45 0.144 0.662 0.788 1.081 1.45 0.938 2.038-0.431 4.238 0.2 5.731 1.856s1.9 3.912 1.256 5.888v0c-0.206 0.644 0.144 1.331 0.788 1.544 0.644 0.206 1.331-0.144 1.544-0.787v-0.006c0.9-2.762 0.331-5.938-1.769-8.269z"></path>
  <path d="M26.587 9.75c-1.025-1.137-2.538-1.569-3.925-1.269-0.569 0.119-0.931 0.688-0.813 1.256 0.125 0.569 0.688 0.931 1.25 0.806v0c0.681-0.144 1.419 0.069 1.919 0.619 0.5 0.556 0.637 1.313 0.419 1.975v0c-0.175 0.55 0.125 1.15 0.681 1.331 0.556 0.175 1.15-0.125 1.331-0.681 0.438-1.356 0.163-2.906-0.863-4.037z"></path>
  <path d="M13.738 21.769c-0.188 0.319-0.594 0.469-0.912 0.337-0.319-0.125-0.412-0.488-0.231-0.794 0.188-0.306 0.581-0.456 0.894-0.337 0.313 0.113 0.425 0.469 0.25 0.794zM12.044 23.931c-0.512 0.819-1.613 1.175-2.438 0.8-0.813-0.369-1.056-1.319-0.544-2.119 0.506-0.794 1.569-1.15 2.387-0.806 0.831 0.356 1.1 1.3 0.594 2.125zM13.969 18.144c-2.519-0.656-5.369 0.6-6.463 2.819-1.119 2.262-0.037 4.781 2.506 5.606 2.637 0.85 5.75-0.456 6.831-2.894 1.069-2.394-0.262-4.85-2.875-5.531z"></path>
  </symbol>
  <symbol id="icon-linkedin" viewBox="0 0 32 32">
  <path d="M29 0h-26c-1.65 0-3 1.35-3 3v26c0 1.65 1.35 3 3 3h26c1.65 0 3-1.35 3-3v-26c0-1.65-1.35-3-3-3zM12 26h-4v-14h4v14zM10 10c-1.106 0-2-0.894-2-2s0.894-2 2-2c1.106 0 2 0.894 2 2s-0.894 2-2 2zM26 26h-4v-8c0-1.106-0.894-2-2-2s-2 0.894-2 2v8h-4v-14h4v2.481c0.825-1.131 2.087-2.481 3.5-2.481 2.488 0 4.5 2.238 4.5 5v9z"></path>
  </symbol>
  </defs>
  </svg>

  <header class="site-head"  style="background-image: url(/images/blog/cover.jpg)" >
  <div class="vertical">
    <div class="site-head-content inner">
       <a class="blog-logo"
        href="/"><img src="/images/blog/avatar.png"
          alt="Blog Logo" /></a> 
      <h1 class="blog-title">NOWHERE</h1>
      <h2 class="blog-description">一些碎碎念</h2>
    </div>

    
  </div>
</header>
  

<main class="content" role="main">
  <article class="post">
    <span class="post-meta">
      <time datetime="2022-05-02T21:34:32.000Z" itemprop="datePublished">
          2022-05-02
      </time>
    
    
    | 
    <a href='/tags/coding/'>coding</a>,
    
    <a href='/tags/note/'>note</a>,
    
    <a href='/tags/ios/'>ios</a>
    
    
</span>
    <h1 class="post-title">Creating Cross Platform SwiftUI App</h1>
    <section class="post-content">
      <p>Last summer I was really in need of a native multi-tab SSH client app that works well on my iPad, so I created <a target="_blank" rel="noopener" href="https://apps.apple.com/us/app/sshaking/id1586587696">SSHaking</a>. It started as a UIKit app with <code>AppDelegate</code> and <code>UITableView</code>s, but a few pages (e.g. Preferences) where implemented in SwiftUI. After multiple iterations through the year, it has now became a modern SwiftUI cross platform app that works well on iOS and macOS. In this post, I’d like to share a few learnings that I’ve gained through this journey.</p>
<p><img src="/images/220502/app-demo.png"></p>
<h2 id="Adopting-SwiftUI"><a href="#Adopting-SwiftUI" class="headerlink" title="Adopting SwiftUI"></a>Adopting SwiftUI</h2><p>The declarative SwiftUI is a completely different world for the imperative UIKit engineers. Instead of manually creating views, setting up properties, and carefully organize the view hierarchy and constraints, you simply <strong>declare</strong> WHAT the view should look like without explicitly specifying the control flow. For example, to create a vertical stack of a title label and subtitle label, instead of creating a <code>UIStackView</code> with two <code>UILabel</code>s, we can simply declare:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">VStack</span> &#123;</span><br><span class="line">    <span class="type">Text</span>(<span class="string">&quot;Title&quot;</span>)</span><br><span class="line">        .font(.headline)</span><br><span class="line">    <span class="type">Text</span>(<span class="string">&quot;Subtitle&quot;</span>)</span><br><span class="line">        .font(.subheadline)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Such a syntax is powered by <a target="_blank" rel="noopener" href="https://docs.swift.org/swift-book/LanguageGuide/AdvancedOperators.html#ID630">Result Builder</a> feature of Swift language, making it possible to write nested data like a list or tree in a natural and declarative way that is almost like a DSL. If you would like to learn SwiftUI, my recommendation would be Apple’s <a target="_blank" rel="noopener" href="https://developer.apple.com/tutorials/swiftui">Introducing SwiftUI</a> tutorials. Very well designed, super easy to follow.</p>
<p>Besides all these fancy views, one important change, in my opinion, is that we can now easily ensure a strong and reactive MVVM pattern through SwiftUI. In my app, most views have <code>@State</code>, <code>@StateObject</code> and/or <code>@ObservedObject</code> that describe the state of the view, and updates to these view models can be automatically propagated to Views and triggers a UI update. If you ever had experience with Flutter (or any other declarative UI pattern), there’s a concise formula that I really like:</p>
<p><img src="/images/220502/ui-equals-function-of-state.png"></p>
<p>This elegant formula describes the idea of declarative pattern very well. When the state of your app changes, it should trigger the update of your UI. It can guarantee a unidirectional data flow through your app and greatly reduce the possibility of issues caused by the inconsistency between data and view. Flutter’s <a target="_blank" rel="noopener" href="https://docs.flutter.dev/development/data-and-backend/state-mgmt/declarative">Think Declaratively</a> is also a well-written resource if you are not familiar with this pattern.</p>
<p>In addition, the efficiency of SwiftUI also enabled me to explore design ideas that could be different from existing native UIKit controls. For example, this is the theme selection view that abstractly displays the theme of terminal colors. SwiftUI allowed me to implement this view in ~10min, which is responsive in all screen sizes and scrolls smoothly at 60fps, without worrying about performance or the nightmare of drawing these colors using CoreGraphics.</p>
<p><img src="/images/220502/theme.png"></p>
<h2 id="Embrace-New-App-Lifecycle"><a href="#Embrace-New-App-Lifecycle" class="headerlink" title="Embrace New App Lifecycle"></a>Embrace New App Lifecycle</h2><p>Farewell, <code>AppDelegate</code> and <code>SceneDelegate</code>! SwiftUI 2.0 has introduced a brand new app structure / life cycle that allows you to declare the app’s structure as you may do with views. The brand new app lifecycle not only helped me removed so much boilerplate code, but also provides a centralized place to handle app level behaviors like deeplink and continue processing user activity with Handoff. I don’t want to cover too much about it here as I think it’s easier to understand if you create a new project and play with it. But here’s a tip: you can always create an <code>AppDelegate</code> class and add <code>@UIApplicationDelegateAdaptor(AppDelegate.self) var appDelegate</code> to your <code>App</code> struct so that you can fill in the gap between the fancy shiny declarative API and the good old robust delegates. For me, I still have an <code>AppDelegate</code> class to handle <code>didFinishLaunching</code> and notification related stuff, but the number of lines got a lot reduced than the old way.</p>
<h2 id="Leverage-Preview"><a href="#Leverage-Preview" class="headerlink" title="Leverage Preview"></a>Leverage Preview</h2><p>SwiftUI comes up with a ridiculously strong preview system, which allows me to test my views live during coding and verify all use cases. You must have used previews if you ever tried SwiftUI, but do you know that you can create a <code>Group</code> of previews with different parameters so that you can see it in different devices, color schemes and orientations? I’m posting my usage here: for some important views, I’m able to display the iPhone and iPad, light and dark, portrait and landscape previews altogether. It definitely speeds up my development, and also helps guarantee that you won’t hit unexpected UI issues on a device/scheme/orientation that you didn’t test.</p>
<p><img src="/images/220502/preview.png"></p>
<h2 id="Maintain-your-own-Swift-Package"><a href="#Maintain-your-own-Swift-Package" class="headerlink" title="Maintain your own Swift Package"></a>Maintain your own Swift Package</h2><p>If you have multiple apps like me, you must have quite a lot shared code, and maintaining your very own Swift package is a great way to organize your private libraries and keep them in sync with all your projects. In my own Swift package, I have:</p>
<ul>
<li>UI components, e.g. cells with image and switch in the settings view that is shown in above screenshot. SwiftUI really encourages you to create nested view structures, so don’t hesitate if you feel some parts can be extracted as a reusable <code>View</code>.</li>
<li>Managers to handle common/general logic, e.g. in-app purchase, data persistence, iCloud synchronization, popovers and alerts, preferences storage (spoiler: it’s <code>PropertyWrapper</code>!), etc.</li>
<li>Random utils, like converting hex to <code>Color</code>, formatting <code>Date</code>, reading properties from <code>Bundle</code>, etc.</li>
</ul>
<p>Comparing to CocoaPods, Swift package is more intuitive (no podspec), more familiar (Swift vs Ruby), supports mutiple formats (source code, binaries, XCFramework), and it’s available out-of-box in Xcode. I do occasionally encounter issues that require a “Reset Packages Caches”, but overall it’s very smooth experience.</p>
<h2 id="Consider-Platform-Differences"><a href="#Consider-Platform-Differences" class="headerlink" title="Consider Platform Differences"></a>Consider Platform Differences</h2><p>Thanks to SwiftUI and MacCatalyst, my iPhone app could run and layout well on iPad and Mac, but it didn’t feel at home on such platforms. iPad and Mac tends to have larger screens, and multi column design is usually a better practice. The biggest iteration that I’ve made to my app was rewriting the whole navigation stack using SwiftUI, which, thanks to the nature of declarative, automatically allows my app to run as normal <code>UINavigationViewController</code> on iPhone (actually, the compact size class, e.g. if you put an iPad app in split screen) and run in two columns with a sidebar on iPad and Mac. </p>
<p>Another key difference between iPad/Mac and iPhone, besides the extra screen size, is that iPads/Macs are more likely to be connected with an external keyboard and pointer device (trackpad or mouse). A few things to consider in your mind:</p>
<ul>
<li>Keyboard shortcuts: Users would expect normal shortcuts to work, like cmd + t to create new tab, cmd + w to close current window/tab, cmd + , to open preferences window, etc.</li>
<li>Keyboard navigation: Use arrow keys to navigate through the list or controls. This would also be helpful for a11y.</li>
<li>Pointer interactions: Users who connect iPad to a pointer device like trackpad or mouse would expect controls to support <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/uikit/pointer_interactions">pointer interactions</a>. If you have custom controls, consider enabling/implementing pointer interactions when it’s proper. It will help your user interacts with your app with a better precision.</li>
<li>Keyboard input assistant items: When connecting to a physical keyboard, iPadOS shows a newly designed popover toolbar which works unfortunately poorly with <code>UIInputView</code>. In this case, consider using <code>UITextInputAssistantItem</code>, which can be displayed inline with the toolbar and creates more space for user to enjoy your app. Below screenshot shows <code>UIInputView</code> vs <code>UITextInputAssistantItem</code> when an iPad connects to an external keyboard.</li>
</ul>
<p><img src="/images/220502/ipad-keyboard.png"></p>
<h2 id="UIKit-is-Your-Last-Resort"><a href="#UIKit-is-Your-Last-Resort" class="headerlink" title="UIKit is Your Last Resort"></a>UIKit is Your Last Resort</h2><p>SwiftUI is nice, but there are still so many things that it cannot do (yet). UIKit is definitely your last resort and it is not hard to embed UIKit views or view controllers inside SwiftUI. In my app, for example, the core multi-tab terminal view is implemented in UIKit and WebKit, as the feature that I need simply doesn’t exist in SwiftUI. With that being said, the idea UI = f(state) still inspires me a lot even when writing UIKit code, and I ended up using some Combine code to create a similar reactive MVVM pattern.</p>
<p>Another use case is for when you want to access some UIKit specific features. Since SwiftUI is (for now) powered by UIKit, you can always just access the backed UIKit views. For the MacCatalyst version of my app, I really wanted the sidebar to have the pretty blurry transparent effect just like other native macOS apps, so I directly accessed the backed <code>UISplitViewController</code> and set <code>primaryBackgroundStyle</code> to <code>.sidebar</code>. To achieve this, you can embed an empty <code>UIViewController</code> to your SwiftUI View using <code>UIViewControllerRepresentable</code>, and access the <code>splitViewController</code> property of your view controller, as it shares the same ancestor as SwiftUI views. <a target="_blank" rel="noopener" href="https://github.com/siteline/SwiftUI-Introspect">SwiftUI-Introspect</a> is an awesome library that provides such APIs so that you can access the hidden UIKit world behind SwiftUI.</p>
<h2 id="Final-Thoughts"><a href="#Final-Thoughts" class="headerlink" title="Final Thoughts"></a>Final Thoughts</h2><p>If you want to start writing an app from scratch, SwiftUI is a good choice to make your development efficient and quickly deliver prototypes. However, due to the huge feature gap and lack of functionalities, the most complicated part of your app is very likely to require UIKit.</p>
<p>If you already have a UIKit app and want to introduce SwiftUI, go for it. Start with migrating those most native, most simple views, like the boring forms and the table view of settings. If you find it helps, you can choose to continue migrate the rest part, even the complete app life cycle.</p>
<p>If you have an iPhone app and want to bring it to iPad and Mac, go through design guidelines and WWDC sessions to understand platform differences. Use your app daily in an unfamiliar way (trackpad and keyboard instead of touch). Leverage new APIs and UI design patterns to make your app feel at home on all platforms.</p>

    </section>
    <footer class="post-footer">
      <section class="author">
    <h4>Yubo Qin</h4>
    <p>真不错</p>
</section>
      <section class="share">
  <h4>分享这篇文章</h4>
  <a target="_blank" rel="noopener" href='https://www.linkedin.com/sharing/share-offsite/?url=https://xnth97.github.io/2022/05/02/swiftui-app-learnings/' onclick="window.open(this.href, 'linkedin-share', 'width=720,height=480');return false;">
    <svg class='icon'>
      <use xlink:href='#icon-linkedin'></use>
    </svg>
    <span class='hidden'>LinkedIn</span>
  </a>
  <a target="_blank" rel="noopener" href='http://service.weibo.com/share/share.php?appkey=&title=Creating Cross Platform SwiftUI App&url=https://xnth97.github.io/2022/05/02/swiftui-app-learnings/&pic=&searchPic=false&style=simple' onclick="window.open(this.href, 'weibo-share', 'width=640,height=360');return false;">
    <svg class='icon'>
      <use xlink:href='#icon-sina-weibo'></use>
    </svg>
    <span class='hidden'>Sina Weibo</span>
  </a>
  <a target="_blank" rel="noopener" href='http://twitter.com/share?url=https://xnth97.github.io/2022/05/02/swiftui-app-learnings/'
    onclick="window.open(this.href, 'twitter-share', 'width=640,height=480');return false;">
    <svg class="icon">
      <use xlink:href="#icon-twitter"></use>
    </svg>
    <span class="hidden">Twitter</span>
  </a>
  <a target="_blank" rel="noopener" href='https://www.facebook.com/sharer/sharer.php?u=https://xnth97.github.io/2022/05/02/swiftui-app-learnings/'
    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
    <svg class="icon">
      <use xlink:href="#icon-facebook2"></use>
    </svg>
    <span class="hidden">Facebook</span>
  </a>
</section>
    </footer>
  </article>
  <nav class="pagination" role="pagination">
    
    <span class="page-number">•</span>
    
    <a class="older-posts" href="/2022/01/24/2021-annual/">
        红花郎杯 2021 年度我最喜爱颁奖 →
    </a>
    
</nav>
  <div id="comment" class="comments-area">
    <div id="disqus_thread"></div>
    <script>
    // var disqus_config = function () {
    // this.page.url = page.permalink;  // Replace PAGE_URL with your page's canonical URL variable
    // this.page.identifier = page.title; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    // };
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://xnth97.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</main>


  
<footer class="site-footer">
  
  <div class="inner">
     <section class="copyright">2022 &copy; Yubo Qin &bull; <a href="/about">关于我</a></section>
  </div>
</footer>

  <script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>
<script>
  function addDarkmodeWidget() {
    const options = {
      label: '🌓',
      autoMatchOsTheme: true
    };

    const darkmode = new Darkmode(options);
    darkmode.showWidget();
  }
  window.addEventListener('load', addDarkmodeWidget);
</script>
</body>
</html>
